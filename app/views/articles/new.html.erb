<% if flash[:error].present? %>
  <div class="error_main">
    <p><%= flash[:error].count %>つのエラーが発生しました</p>
    <% flash[:error].each do |error| %>
      <li><%= error %></li>
    <% end %>
  </div>
<% end %>
<%= form_with(model: @article, url: article_confirm_new_article_path, local: true) do |f| %>
  <%= render 'shared/error', object: f.object %>
  <div class='form-group'>
    <%= f.text_field :title, class: 'title_field', :placeholder => 'タイトル', :value => session[:article_title] %>
  </div>
  <div class='form-group tag_category'>
    <%= fields_for :category do |category_f| %>
      <%= category_f.select :category_id, @categories.map{ |category| [category.name, category.id]}, selected: => session[:category_id] %>
    <% end %>
    <%= f.text_field :tag_name, class: 'tag_field', :placeholder => 'タグを複数つけるには,(カンマ)で区切ってください(例：Ruby,Rails,SQL)', :value => session[:article_tag_name] %>
  </div>
  <div class='form-group'>
    <%= render 'template' %>
    <div id='editor'>
      <%= f.text_area :body, class: 'form-control text_area_markdown', id: 'note_explanation', "v-model" => "input", :placeholder => 'Markdown記法で書いて共有しよう', :value => session[:article_body]%>
    <div v-html='input | marked' class="markdown_preview" id="template2"></div>
    </div>
  </div>
  <%= f.hidden_field :user_id, :value => current_user.id %>
  <%= f.submit '登録', class: 'article_btn' %>
  </div>
  <% end %>

  <!-- リアルタイムプレビュー -->
  <script type="text/javascript">
    window.onload = function() {
      new Vue({
      el: '#editor',
      data: {
        input: '<%= j @article.body %>',
      },
      filters: {
      marked: marked,
      },
      });
    };
  </script>